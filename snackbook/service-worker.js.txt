self.addEventListener('install', e => self.skipWaiting());
self.addEventListener('activate', e => self.clients.claim());

// Intercept POST /share vom Web Share Target
self.addEventListener('fetch', event => {
  const url = new URL(event.request.url);
  if (url.pathname === '/share' && event.request.method === 'POST') {
    event.respondWith((async () => {
      const form = await event.request.formData();
      const text = form.get('text') || '';
      const shareUrl = form.get('url') || '';
      const title = form.get('title') || '';
      const payload = encodeURIComponent(JSON.stringify({ text, url: shareUrl, title }));
      // per Redirect auf share.html weitergeben
      return Response.redirect(`/share.html#data=${payload}`, 303);
    })());
  }
});
